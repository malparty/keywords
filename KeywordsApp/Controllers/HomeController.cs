using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Extensions.Logging;
using KeywordsApp.Models;
using KeywordsApp.Data;
using Microsoft.AspNetCore.Authorization;
using System.Net.Http;
using System.Net.Http.Headers;
using HtmlAgilityPack;
using System.Threading;

namespace keywords.Controllers
{
    [Authorize]
    public class HomeController : Controller
    {
        private readonly ILogger<HomeController> _logger;
        private readonly KeywordContext _dbContext;

        public HomeController(ILogger<HomeController> logger, KeywordContext dbContext)
        {
            _logger = logger;
            _dbContext = dbContext;
        }


        public async Task<IActionResult> Index()
        {
            //
            //
            // IMPROVEMENT: can have 2 threads (one using proxy, the other one direct google?)
            //
            //
            const int MAX_RETRY = 10;

            var searchResults = new List<KeyResult>();
            var queryList = new string[]{"bonjour", "palace","minister","outline",
                        "veteran","ethics","swing","inspiration",
                        "poem","wife","tired","tower",
                        "danger","stomach","embarrassment","flock",
                        "fire","thin","detective","item","owner",
                        "ignore","berry","gun","black",
                        "prefer","plan","dentist","jam",
                        "dictate","exposure","remind","hate",
                        "definition","monk","lid","demonstration",
                        "throat","war","kidnap","swipe",
                        "prosecute","expenditure","syndrome","fog",
                        "instrument","adjust","shame","day","constituency","domestic",
                        "glimpse","grind","expose","ivory","pierce","pan","correction",
                        "joystick","cafe","bet","east","grow","partnership",
                        "traffic","consolidate","poetry","fat","drift","democratic",
                        "owner","academy","labour","inflation",
                        "young","spring","negotiation","flow","adoption",
                        "visit","embark","surprise",
                        "tragedy","essential","cabin","survivor","monarch","trial",
                        "scramble","splurge","sink","gregarious","feel","football","satisfaction","flawed","reporter",
                        "deteriorate","move","excess","sanctuary",
                        "wonder",
"conscience",
"hard",
"trend",
"critic",
"move",
"dignity",
"gradual",
"bank",
"pledge",
"crowd",
"tasty",
"runner",
"appear",
"community",
"fraud",
"lawyer",
"stumble",
"tell",
"ballot",
"pest",
"sector",
"hallway",
"promotion",
"manufacture",
"quotation",
"leader",
"fragment",
"god",
"brag",
"discrimination",
"breast",
"support",
"carriage",
"hit",
"hot",
"quaint",
"kidney",
"vegetarian",
"disgrace",
"code",
"clerk",
"confrontation",
"slump",
"summit",
"profit",
"sigh",
"bite",
"call",
"item",
"carpet",
"cancel",
"torch",
"franchise",
"technique",
"radiation",
"explicit",
"cherry",
"strategic",
"flow",
"treasurer",
"revoke",
"hover",
"available",
"disposition",
"extraterrestrial",
"mistreat",
"foundation",
"safety",
"cycle",
"bulb",
"oil",
"trouser",
"member",
"create",
"attention",
"houseplant",
"clear",
"contemporary",
"mean",
"freighter",
"manufacturer",
"landscape",
"diameter",
"mechanism",
"cheek",
"organisation",
"bishop",
"value",
"tread",
"coach",
"gene",
"quotation",
"mosquito",
"express",
"absence",
"prevalence",
"execution",
"wolf",
"fine",
"bare",
"qualify",
"psychology",
"braid",
"heir",
"hand",
"notion",
"criticism",
"sail",
"clock",
"waiter",
"houseplant",
"earthflax",
"flow",
"association",
"strain",
"characteristic",
"paradox",
"art",
"deal",
"bargain",
"eagle",
"automatic",
"artist",
"story",
"fence",
"do",
"trust",
"direct",
"fox",
"bed",
"suspicion",
"tumour",
"sigh",
"formula",
"poem",
"deserve",
"extort",
"conspiracy",
"soft",
"form",
"debate",
"agency",
"refuse",
"secular",
"apple",
"college",
"care",
"domination",
"hover",
"absorption",
"payment",
"case",
"unit",
"computing",
"sight",
"message",
"preoccupation",
"bar",
"confuse",
"snatch",
"debate",
"assume",
"main",
"mistreat",
"young",
"fix",
"generate",
"rice",
"ambition",
"contempt",
"sphere",
"clean",
"executrix",
"detective",
"angle",
"expectation",
"free",
"baby",
"user",
"wriggle",
"urine",
"date",
"dress",
"motivation",
"criminal",
"reward",
"board",
"salvation",
"analyst",
"manage",
"health",
"freedom",
"determine",
"falsify",
"punish",
"player",
"conspiracy",
"bulb",
"leadership",
"necklace",
"cater",
"resist",
"constitutional",
"pneumonia",
"embark",
"heir",
"pardon",
"process",
"population",
"innovation",
"spine",
"bronze",
"quote",
"detail",
"bald",
"movie",
"evening",
"disaster",
"overwhelm",
"word",
"throat",
"trial",
"incredible",
"panel",
"aid",
"cow",
"cabin",
"ankle",
"minor",
"tent",
"enemy",
"performer",
"ambiguity",
"text",
"tape",
"lesson",
"occupation",
"familiar",
"long",
"mouth",
"monk",
"salesperson",
"evaluate",
"forecast",
"revive",
"organize",
"TRUE",
"prescription",
"sentiment",
"jurisdiction",
"discreet",
"camera",
"correspond",
"profession",
"incapable",
"idea",
"imposter",
"sample",
"threat",
"purpose",
"carriage",
"scatter",
"egg",
"squeeze",
"reality",
"harmony",
"due",
"game",
"friend",
"disco",
"truck",
"chimpanzee",
"scrap",
"scenario",
"costume",
"action",
"suffer",
"worker",
"cellar",
"neglect",
"rainbow",
"bring",
"outlook",
"decay",
"assertive",
"sofa",
"retired",
"continuous",
"reconcile",
"register",
"reform",
"problem",
"tumble",
"authorise",
"slow",
"urine",
"undertake",
"wild",
"new",
"straighten",
"invasion",
"basketball",
"chicken",
"buy",
"gutter",
"faithful",
"hesitate",
"separate",
"broccoli",
"unfair",
"depend",
"threaten",
"stem",
"train",
"stall",
"try",
"partner",
"discriminate",
"border",
"rent",
"athlete",
"relaxation",
"tile",
"faint",
"script",
"maid",
"dance",
"preparation",
"sustain",
"blind",
"democratic",
"provide",
"stir",
"boat",
"rescue",
"lonely",
"order",
"letter",
"statement",
"volume",
"dream",
"limited",
"snow",
"cereal",
"update",
"occupation",
"monkey",
"loud",
"essential",
"captain",
"arrest",
"flow",
"beautiful",
"deficiency",
"condition",
"color",
"password",
"loyalty",
"option",
"inhabitant",
"mature",
"rank",
"iron",
"loose",
"stand",
"laborer",
"sample",
"fate",
"action",
"impact",
"bad",
"nursery",
"lane",
"X-ray",
"inspire",
"trivial",
"mistreat",
"pat",
"tournament",
"cellar",
"market",
"consideration",
"favor",
"wild",
"embark",
"survey",
"car",
"brave",
"helpless",
"grand",
"volunteer",
"board",
"infection",
"oil",
"major",
"football",
"attraction",
"document",
"cultural",
"whip",
"malicious",
"vigorous",
"shiny",
"initiate",
"telling",
"dreary",
"mammoth",
"fine",
"flagrant",
"number",
"respect",
"horses",
"construe",
"express",
"crooked",
"dynamic",
"endurable",
"impinge",
"boy",
"stick",
"absorbed",
"tacit",
"cycle",
"exchange",
"swot",
"crazy",
"thick",
"boast",
"writer",
"cherry",
"restrain",
"argument",
"uttermost",
"apple",
"metal",
"machine",
"spell",
"way",
"prescribe",
"writing",
"leather",
"imprison",
"download",
"spicy",
"tank",
"bloody",
"empty",
"available",
"ancient",
"exciting",
"weight",
"hurl",
"heavy",
"faulty",
"economic",
"minute",
"sail",
"subsequent",
"zinc",
"seemly",
"swear",
"gainful",
"guitar",
"preside",
"tremble",
"fascinated",
"send",
"distribute",
"elastic",
"sag",
"crush",
"consist",
"yummy",
"happen",
"admit",
"sable",
"supreme",
"interest",
"uttermost",
"break",
"recast",
"bend",
"new",
"pollution",
"cool",
"boundless",
"frame",
"income",
"motivate",
"create",
"rot",
"wandering",
"smelly",
"vase",
"curve",
"harsh",
"torpid",
"chairs",
"scold",
"race",
"accept",
"bottle",
"dad",
"tranquil",
"flowery",
"level",
"gainful",
"taboo",
"wonderful",
"car",
"coach",
"sadden",
"coal",
"fancy",
"discussion",
"various",
"hulking",
"month",
"unwieldy",
"breakfast",
"resell",
"surround",
"jagged",
"swot",
"health",
"nutty",
"toss",
"warn",
"string",
"brick",
"sidewalk",
"instinctive",
"momentous",
"blue-eyed",
"poised",
"father",
"nifty",
"marry",
"jumbled",
"lean",
"past",
"stare",
"different",
"sass",
"shine",
"fifth",
"banish",
"piquant",
"songs",
"atten",
"chair",
"insure",
"aberrant",
"longing",
"join",
"normal",
"line",
"tranquil",
"gratis",
"uneven",
"light",
"winter",
"horses",
"praise",
"nasty",
"need",
"obtainable",
"thoughtful",
"knock",
"weather",
"quaint",
"wheel",
"rattle",
"dynamic",
"vulgar",
"recite",
"snap",
"retire",
"even",
"rake",
"knee",
"catch",
"TRUE",
"leak",
"fall",
"toothsome",
"sense",
"identify",
"breathe",
"ablaze",
"want",
"aftermath",
"stranger",
"rate",
"summon",
"force",
"recollect",
"stimulating",
"climb",
"heavy",
"field",
"pass",
"meek",
"cars",
"aggressive",
"creepy",
"tightfisted",
"contend",
"melted",
"mist",
"distance",
"food",
"exclaim",
"greedy",
"travel",
"vessel",
"ring",
"null",
"fling",
"invincible",
"volleyball",
"inhabit",
"thinkable",
"abortive",
"state",
"convict",
"bubble",
"pretty",
"bet",
"cut",
"vast",
"pardon",
"married",
"expand",
"die",
"float",
"subtract",
"iron",
"healthy",
"tent",
"check",
"gabby",
"shape",
"hug",
"balance",
"break",
"board",
"expand",
"rebel",
"show",
"hate",
"prose",
"cushion",
"erase",
"puzzling",
"spoon",
"two",
"slay",
"mysterious",
"damp",
"talented",
"drum",
"competition",
"distribution",
"property",
"caring",
"gag",
"atten",
"paint",
"light",
"heady",
"rude",
"forlese",
"sidewalk",
"place",
"bend",
"show",
"bee",
"spooky",
"mom",
"corrod",
"preside",
"think",
"wanting",
"open",
"abandon",
"ladybug",
"rat",
"apparel",
"honey",
"drunk",
"womanly",
"purring",
"soggy",
"terrific",
"tee",
"nebulous",
"hole",
"keen",
"nest",
"red",
"equal",
"clear",
"swing",
"nasty",
"bend",
"voracious",
"bite",
"shiny",
"measly",
"whole",
"initiate",
"hide",
"scarecrow",
"co-operate",
"new",
"part",
"scar",
"guess",
"whisper",
"drag",
"pleasant",
"sock",
"produce",
"credit",
"wealth",
"prescribe",
"insert",
"inlay",
"implore",
"suffer",
"repulsive",
"mind",
"fresh",
"recast",
"straw",
"dump",
"snails",
"propose",
"participate",
"crown",
"auspicious",
"tremble",
"second-hand",
"envious",
"pencil",
"smiling",
"pathetic",
"stormy",
"remarkable",
"natural",
"drink",
"sniff",
"magical",
"faint",
"ride",
"hate",
"selective",
"rise",
"correct",
"hall",
"adaptable",
"club",
"utter",
"lawyer",
"crib",
"snap",
"quarter",
"humiliate",
"many",
"tough",
"hope",
"cloistered",
"toss",
"bulb",
"wash",
"giant",
"comb",
"second",
"pen",
"retain",
"bell",
"breakfast",
"earthquake",
"stem",
"phobic",
"afternoon",
"expensive",
"voracious",
"silk",
"pencil",
"nation",
"number",
"donate",
"alley",
"police",
"desire",
"decisive",
"questionable",
"saponify",
"map",
"tee",
"substantial",
"plucky",
"stimulate",
"permissible",
"screeching",
"parent",
"burn",
"permissible",
"cast",
"take",
"inhabit",
"ashamed",
"finish",
"stocking",
"inquire",
"let",
"marked",
"minute",
"cower",
"shout",
"amuck",
"lacking",
"scare",
"aspiring",
"last",
"FALSE",
"two",
"quill",
"accidental",
"overflow",
"inscribe",
"belong",
"fifth",
"sweet",
"sudden",
"fire",
"billowy",
"bang",
"relation",
"correspon",
"relate",
"toe",
"deal",
"water",
"infringe",
"stereotyped",
"bed",
"sag",
"fail",
"sparkle",
"check",
"confine",
"dysfunctional",
"long",
"part",
"nappy",
"card",
"fly",
"consen",
"hapless",
"efficient",
"space",
"trite",
"absurd",
"forget",
"road",
"various",
"massive",
"huge",
"charming",
"redo",
"savvy",
"observation",
"pan",
"ski",
"field",
"plod",
"rich",
"devilish",
"assert",
"shivering",
"soothe",
"rub",
"ocean",
"toy",
"witty",
"imprint",
"scant",
"apples",
"moaning",
"rattle",
"like",
"juicy",
"imminent",
"trail",
"consort",
"neighborly",
"live",
"consist",
"practise",
"writer",
"disease",
"guess",
"slow",
"grumpy",
"comfort",
"profuse",
"crackle",
"farm",
"magnify",
"game",
"actually",
"push",
"outgoing",
"breakfast",
"teeny-tiny",
"grip",
"vague",
"bind",
"grotesque",
"sordid",
"sore",
"fanatical",
"comfort",
"frail",
"unsightly",
"good-bye",
"jam",
"wretched",
"value",
"quartz",
"books",
"torpid",
"quaint",
"crave",
"fabulous",
"wire",
"close",
"hearing",
"gigantic",
"bloody",
"board",
"hunt",
"trick",
"rub",
"imminent",
"available",
"balloon",
"cheap",
"net",
"proceed",
"sabotage",
"screw",
"exuberant",
"tear",
"milky",
"identify",
"zoo",
"jagged",
"dock",
"sticks",
"awake",
"winter",
"phobic",
"famous",
"anxious",
"scam",
"halting",
"gamy",
"offbeat",
"sweet",
"contribute",
"productive",
"seem",
"feed",
"blue",
"humorous",
"grubby",
"donate",
"vest",
"display",
"pancake",
"unsightly",
"ten",
"pray",
"exchange",
"yarn",
"flash",
"impeach",
"disgust",
"neat",
"reflect",
"light",
"game",
"renounce",
"sweep",
"friction",
"five",
"fetch",
"frantic",
"numberless",
"bored",
"teeny",
"dependent",
"distribution",
"arrogant",
"lamp",
"hypnotic",
"rob",
"meet",
"wry",
"innovate",
"magnify",
"responsible",
"coal",
"fairies",
"whimsical",
"color",
"smart",
"lead",
"mean",
"participate",
"tenuous",
"hatch",
"mash",
"strain",
"chunky",
"state",
"fortunate",
"houses",
"embarrassed",
"choke",
"wish",
"sob",
"savvy",
"straight",
"ugly",
"frame",
"square",
"capture",
"old-fashioned",
"carpenter",
"hope",
"guide",
"inflect",
"obnoxious",
"share",
"war",
"versed",
"kiss",
"adamant",
"edge",
"vie",
"picayune",
"ducks",
"rhythm",
"unwritten",
"abnormal",
"sleep",
"alley",
"productive",
"glove",
"hot",
"bubble",
"aftermath",
"sticky",
"corrod",
"massive",
"convey",
"zinc",
"insect",
"new",
"avoid",
"puny",
"morning",
"blade",
"aboriginal",
"tub",
"abrupt",
"aspiring",
"juice",
"consult",
"wax",
"abnormal",
"boring",
"include",
"sense",
"necessary",
"free",
"kitty",
"milky",
"rapid",
"bust",
"restrain",
"address",
"tree",
"ocean",
"wealth",
"tiresome",
"tidy",
"infuse",
"news",
"throw",
"exist",
"astonishing",
"dirty",
"square",
"texture",
"decide",
"apathetic",
"pray",
"hold",
"writer",
"paint",
"print",
"long",
"constitute",
"curtain",
"spooky",
"famous",
"furtive",
"responsible",
"available",
"quicksand",
"shop",
"drop",
"sparkling",
"annoying",
"thing",
"cord",
"precious",
"miss",
"aloof",
"weight",
"screw",
"pets",
"loving",
"measure",
"channel",
"wave",
"roll",
"endanger",
"stick",
"tear",
"blow",
"cheer",
"second-hand",
"ponder",
"afraid",
"work",
"condition",
"destroy",
"bear",
"gun",
"woozy",
"spooky",
"fearless",
"vague",
"six",
"polish",
"terminate",
"empower",
"stew",
"apologize",
"immense",
"slink",
"meek",
"faucet",
"avoid",
"tenuous",
"ripe",
"patch",
"hushed",
"north",
"sense",
"admire",
"goofy",
"bells",
"mom",
"puzzled",
"jam",
"naive",
"rush",
"relate",
"wear",
"fork",
"word",
"roll",
"fill",
"broken",
"humiliate",
"unkempt",
"ache",
"nap",
"hide",
"smile",
"detail",
"flat",
"loutish",
"laugh",
"zealous",
"kitty",
"right",
"crack",
"careless",
"cling",
"leather",
"tempt",
"prescribe",
"inquisitive",
"skillful",
"grey",
"unwritten",
"didactic",
"huge",
"hesitant",
"obtainable",
"income",
"discovery",
"advice",
"minute",
"hole",
"strong",
"crowd",
"mitten",
"toothbrush",
"glitter",
"shirt",
"chess",
"acoustics",
"power",
"latch",
"square",
"night",
"few",
"car",
"pollute",
"game",
"constrain",
"immure",
"box",
"rebel",
"next",
"warlike",
"cash",
"savvy",
"salvage",
"inspect",
"let",
"swallow",
"ancient",
"rely",
"anger",
"confused",
"drink",
"stormy",
"fish",
"houses",
"jelly",
"pen",
"sand",
"beginner",
"glass",
"unusual",
"opinion",
"lead",
"apples",
"blue-eyed",
"impulse",
"stimulate",
"voiceless",
"full",
"baby",
"mailbox",
"birds",
"recur",
"hard",
"fold",
"lunch",
"actually",
"debonair",
"thump",
"curvy",
"bring",
"endanger",
"nice",
"migrate",
"superficial",
"resist",
"range",
"miscreant",
"eat",
"sort",
"rabbit",
"trite",
"cooing",
"cut",
"subtract",
"scattered",
"preset",
"dirty",
"knit",
"creator",
"consecrat",
"twist",
"crime",
"confess",
"sock",
"nest",
"lying",
"thoughtful",
"split",
"sea",
"reflect",
"lopsided",
"yoke",
"stem",
"flowers",
"blur",
"mint",
"connection",
"click",
"go",
"delirious",
"ladybug",
"ill-treat",
"outstanding",
"ahead",
"right",
"mitten",
"moaning",
"wall",
"wise",
"put",
"nail",
"kite",
"spooky",
"greedy",
"gold",
"busy",
"stormy",
"fearful",
"contest",
"distribute",
"hope",
"crabby",
"development",
"smash",
"drug",
"fluffy",
"burly",
"button",
"yoke",
"spill",
"acidic",
"seemly",
"wretched",
"dull",
"psychedelic",
"story",
"overjoyed",
"scarify",
"injure",
"needle",
"love",
"fax",
"girls",
"grab",
"gaping",
"powerful",
"fill",
"lace",
"shelf",
"arithmetic",
"numerous",
"shirk",
"hair",
"caption",
"band",
"resell",
"lead",
"vary",
"ill-informed",
"edge",
"console",
"uncle",
"eggs",
"wing",
"steady",
"illuminate",
"hang",
"crate",
"lavish",
"pets",
"empower",
"proceed"
                        };


            var proxyServers = new string[]{"us13",
                            "eu2","us1","us2","us3","us4","us5","us6","us7","us8","us9","us10",
                            "us11","us12","us13","us14","us15","us16","us17","eu1","eu2","eu3","eu4","eu5","eu6",
                            "eu7","eu8","eu9","eu10","eu11","eu12","eu13","eu14","eu15"};
            HttpClient client = new HttpClient();
            try
            {
                var googleIndex = 0;
                foreach (var keyword in queryList) // .Take(1)
                {
                    Console.WriteLine("Parsing new keyword: " + keyword);

                    // Call proxy with Server arg and Google query:
                    var googleUrls = new string[] {"https://www.google.com/search",
                    "https://www.google.com.vn/search"
                    }
                    ;
                    var queryGoogle = googleUrls[googleIndex] + "?q=" + keyword;

                    int retryCount = 0;
                    HttpResponseMessage respProxy = null;
                    do
                    {

                        // Build request:
                        var request = new HttpRequestMessage(HttpMethod.Get, queryGoogle);
                        // var request = new HttpRequestMessage(HttpMethod.Post, proxyUrl);

                        // Build Client header
                        request.Headers.Accept.Clear();
                        // The user agent describe to google which device is requesting.
                        // It enable us to get Desktop-style UI instead of Mobile version (that does not include stats)
                        request.Headers.UserAgent.ParseAdd("Mozilla/5.0 (Windows NT 10.0; Win64; x64)");
                        request.Headers.UserAgent.ParseAdd("AppleWebKit/537.36 (KHTML, like Gecko)");
                        request.Headers.UserAgent.ParseAdd("Chrome/90.0.4430.85");
                        request.Headers.UserAgent.ParseAdd("Safari/537.36");
                        request.Headers.UserAgent.ParseAdd("Edg/90.0.818.49");

                        // Add an Accept header for JSON format.
                        // These correspond to what a classic web browser would expose
                        request.Headers.Accept.Add(new MediaTypeWithQualityHeaderValue("text/html"));
                        request.Headers.Accept.Add(new MediaTypeWithQualityHeaderValue("application/xhtml+xml"));
                        request.Headers.Accept.Add(new MediaTypeWithQualityHeaderValue("application/xml"));
                        request.Headers.Accept.Add(new MediaTypeWithQualityHeaderValue("image/webp"));
                        request.Headers.Accept.Add(new MediaTypeWithQualityHeaderValue("image/apng"));
                        request.Headers.Accept.Add(new MediaTypeWithQualityHeaderValue("*/*"));
                        request.Headers.Accept.Add(new MediaTypeWithQualityHeaderValue("application/signed-exchange"));

                        // Set language to english
                        request.Headers.AcceptLanguage.ParseAdd("en-US");

                        respProxy = client.SendAsync(request, cancellationToken: CancellationToken.None).Result;

                        // Preventing error 429 - Too many requests
                        if (!respProxy.IsSuccessStatusCode)
                        {
                            retryCount++;
                            Console.WriteLine("Trying to dispose HttpClient (x" + retryCount + ")");
                            client.Dispose();
                            client = new HttpClient();
                        }
                    } // Exit loop with Successful request or Max Retry count reached.
                    while (retryCount < MAX_RETRY && !respProxy.IsSuccessStatusCode);

                    if (respProxy.IsSuccessStatusCode)
                    {
                        searchResults.Add(new KeyResult
                        {
                            Keyword = keyword,
                            PageContent = await respProxy.Content.ReadAsStringAsync()
                        });
                        // break; // No need to try with another server
                        Console.WriteLine("GOOD!!");

                    }
                    // Too many requests - bot detected
                    else if ((int)respProxy.StatusCode == 429)
                    {
                        Console.WriteLine("Google send '429 (Too many requests)");
                        Console.WriteLine(respProxy.Content);
                        Console.WriteLine(respProxy.ReasonPhrase);
                        Console.WriteLine(respProxy.Headers);
                        Console.WriteLine("EXPERIMENTATION FAILED!!");
                    }
                    else
                    {
                        // Need to try with another server
                        Console.WriteLine("EXPERIMENTATION FAILED!!");
                        Console.WriteLine("Parsing Proxy unsufessful:");
                        Console.WriteLine("{0} ({1})", (int)respProxy.StatusCode, respProxy.ReasonPhrase);
                    }
                }
            }
            catch (Exception e)
            {
                Console.Error.Write(e.Message);
                Console.Error.Write(e.Data);
                // Mark current object status as failed.
            }
            finally
            {
                client.Dispose();
            }
            // Persist current data changes

            return View(searchResults);
        }

        public IActionResult Privacy()
        {
            return View();
        }

        [ResponseCache(Duration = 0, Location = ResponseCacheLocation.None, NoStore = true)]
        public IActionResult Error()
        {
            return View(new ErrorViewModel { RequestId = Activity.Current?.Id ?? HttpContext.TraceIdentifier });
        }
    }
}
